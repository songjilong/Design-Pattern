# åŸºæœ¬ä»‹ç»

> åœ¨è½¯ä»¶è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å‘æŸäº›å¯¹è±¡å‘é€ä¸€äº›è¯·æ±‚ï¼Œä½†æ˜¯å¹¶ä¸çŸ¥é“è¯·æ±‚çš„æ¥æ”¶è€…æ˜¯è°ï¼Œä¹Ÿä¸çŸ¥é“è¢«è¯·æ±‚çš„æ“ä½œæ˜¯å“ªä¸ªï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¨‹åºè¿è¡Œæ—¶æŒ‡å®šå…·ä½“çš„è¯·æ±‚æ¥æ”¶è€…å³å¯ï¼Œæ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¨¡å¼æ¥è®¾è®¡ï¼Œä½¿å¾—è¯·æ±‚å‘é€è€…ä¸è¯·æ±‚æ¥æ”¶è€…æ¶ˆé™¤å½¼æ­¤ä¹‹é—´çš„è€¦åˆï¼Œè®©å¯¹è±¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»æ›´åŠ çµæ´»ã€‚

å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰å¯ä»¥å¯¹å‘é€è€…å’Œæ¥æ”¶è€…å®Œå…¨è§£è€¦ï¼Œå‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å¼•ç”¨å…³ç³»ï¼Œå‘é€è¯·æ±‚çš„å¯¹è±¡åªéœ€è¦çŸ¥é“å¦‚ä½•å‘é€è¯·æ±‚ï¼Œè€Œä¸å¿…çŸ¥é“å¦‚ä½•å®Œæˆè¯·æ±‚ã€‚

å‘½ä»¤æ¨¡å¼å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿æˆ‘ä»¬å¯ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ï¼›å¯¹è¯·æ±‚æ’é˜Ÿæˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œä»¥åŠæ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚

# æ¨¡å¼ç»“æ„

![](https://gitee.com/songjilong/FigureBed/raw/master/img/20200425234945.png)

- Invokerï¼šè°ƒç”¨è€…ï¼Œå‘é€å‘½ä»¤
- Receiverï¼šæ¥æ”¶è€…ï¼Œæ¥æ”¶å‘½ä»¤

- Commandï¼šæŠ½è±¡å‘½ä»¤ç±»ï¼Œå®šä¹‰äº†æ‰€æœ‰çš„å‘½ä»¤
- ConcreteCommandï¼šå…·ä½“å‘½ä»¤ç±»ï¼Œè°ƒç”¨æ¥æ”¶è€…çš„æ“ä½œ

# ä¸¾ä¾‹è¯´æ˜

> ç°æœ‰è®¸å¤šå®¶ç”µï¼ˆç”µç¯ã€ç”µè§†æœºã€ç©ºè°ƒ....ï¼‰ï¼Œæ¯ä¸ªå®¶ç”µéƒ½æœ‰è‡ªå·±çš„æ§åˆ¶è£…ç½®ï¼Œå¦‚æœéœ€è¦æ§åˆ¶å®ƒä»¬ï¼Œéœ€è¦é€ä¸ªå¼€å¯ã€é€ä¸ªå…³é—­ï¼Œè¿™æ—¶å€™ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸‡èƒ½é¥æ§å™¨ï¼ˆå¦‚ä¸‹å¦‚æ‰€ç¤ºï¼‰ï¼Œæ“ä½œä¸åŒçš„å®¶ç”µåªéœ€è¦æŒ‰å¯¹åº”çš„æŒ‰é’®å³å¯ï¼Œå¦‚ä½•ä½¿ç”¨å‘½ä»¤æ¨¡å¼å®ç°ï¼Ÿ

<img src="https://gitee.com/songjilong/FigureBed/raw/master/img/20200425233344.png" style="zoom: 67%;" />

1ã€åˆ›å»ºç”µç¯çš„å‘½ä»¤æ¥æ”¶è€…

```java
public class LightReceiver {
    public void on() {
        System.out.println("ç”µç¯æ‰“å¼€äº†");
    }

    public void off() {
        System.out.println("ç”µç¯å…³é—­äº†");
    }
}
```

2ã€åˆ›å»ºæŠ½è±¡çš„å‘½ä»¤æ¥å£

```java
public interface Command {
    /**
     * æ‰§è¡Œå‘½ä»¤
     */
    void execute();

    /**
     * æ’¤é”€å‘½ä»¤
     */
    void undo();
}
```

3ã€åˆ›å»ºç”µç¯çš„å¼€å¯ã€å…³é—­å‘½ä»¤ç±»ï¼Œå®ç°å‘½ä»¤æ¥å£

```java
public class LightOnCommand implements Command {
    private LightReceiver lightReceiver;

    public LightOnCommand(LightReceiver lightReceiver) {
        this.lightReceiver = lightReceiver;
    }

    @Override
    public void execute() {
        lightReceiver.on();
    }

    @Override
    public void undo() {
        lightReceiver.off();
    }
}
```

```java
public class LightOffCommand implements Command {
    private LightReceiver lightReceiver;

    public LightOffCommand(LightReceiver lightReceiver) {
        this.lightReceiver = lightReceiver;
    }

    @Override
    public void execute() {
        lightReceiver.off();
    }

    @Override
    public void undo() {
        lightReceiver.on();
    }
}
```

4ã€åˆ›å»ºç©ºçš„å‘½ä»¤ç±»ï¼Œç”¨äºåˆå§‹åŒ–æŒ‰é’®

```java
public class NullCommand implements Command {
    @Override
    public void execute() { }

    @Override
    public void undo() { }
}
```

5ã€åˆ›å»ºå‘½ä»¤è°ƒç”¨è€…

```java
public class RemoteController {
    /**
     * æ“ä½œå¯¹è±¡çš„ä¸ªæ•°
     */
    private static final int COUNT = 5;
    /**
     * å¼€å¯å‘½ä»¤ç»„
     */
    Command[] onCommands;
    /**
     * å…³é—­å‘½ä»¤ç»„
     */
    Command[] offCommands;
    /**
     * æ‰§è¡Œæ’¤é”€çš„å‘½ä»¤
     */
    Command undoCommand;

    /**
     * åˆå§‹åŒ–
     */
    public RemoteController() {
        onCommands = new Command[COUNT];
        offCommands = new Command[COUNT];
        for (int i = 0; i < COUNT; i++) {
            onCommands[i] = new NullCommand();
            offCommands[i] = new NullCommand();
        }
    }

    /**
     * è®¾ç½®æŒ‰é’®
     */
    public void setCommand(int no, Command onCommand, Command offCommand) {
        onCommands[no] = onCommand;
        offCommands[no] = offCommand;
    }

    /**
     * æŒ‰ä¸‹å¼€æŒ‰é’®
     */
    public void pressOnButton(int no) {
        onCommands[no].execute();
        //è®°å½•æŒ‰é’®ï¼Œä»¥ä¾¿æ’¤é”€
        undoCommand = onCommands[no];
    }

    /**
     * æŒ‰ä¸‹å…³æŒ‰é’®
     */
    public void pressOffButton(int no) {
        offCommands[no].execute();
        //è®°å½•æŒ‰é’®ï¼Œä»¥ä¾¿æ’¤é”€
        undoCommand = offCommands[no];
    }

    /**
     * æŒ‰ä¸‹æ’¤é”€æŒ‰é’®
     */
    public void pressUndoButton(int no) {
        if (undoCommand != null) {
            undoCommand.undo();
        }
    }
}
```

6ã€æµ‹è¯•ç±»

```java
public class Client {
    @Test
    public void testLight() {
        //åˆ›å»ºå‘½ä»¤æ¥æ”¶è€…
        LightReceiver lightReceiver = new LightReceiver();
        //åˆ›å»ºç”µç¯çš„ä¸€ç»„æ“ä½œï¼ˆå¼€å’Œå…³ï¼‰
        LightOnCommand lightOnCommand = new LightOnCommand(lightReceiver);
        LightOffCommand lightOffCommand = new LightOffCommand(lightReceiver);
        //åˆ›å»ºå‘½ä»¤è°ƒç”¨è€…
        RemoteController remoteController = new RemoteController();
        //è®¾ç½®å‘½ä»¤
        remoteController.setCommand(0, lightOnCommand, lightOffCommand);
        //æ‰§è¡Œå‘½ä»¤
        System.out.println("----æŒ‰ä¸‹å¼€ç¯æŒ‰é’®----");
        remoteController.pressOnButton(0);
        System.out.println("----æŒ‰ä¸‹å…³ç¯æŒ‰é’®----");
        remoteController.pressOffButton(0);
        System.out.println("----æŒ‰ä¸‹æ’¤é”€æŒ‰é’®----");
        remoteController.pressUndoButton(0);
    }
}
```

7ã€è¿è¡Œç»“æœ

```
----æŒ‰ä¸‹å¼€ç¯æŒ‰é’®----
ç”µç¯æ‰“å¼€äº†
----æŒ‰ä¸‹å…³ç¯æŒ‰é’®----
ç”µç¯å…³é—­äº†
----æŒ‰ä¸‹æ’¤é”€æŒ‰é’®----
ç”µç¯æ‰“å¼€äº†
```

8ã€å¦‚æœå†æ·»åŠ ä¸€ä¸ªç”µè§†æœºï¼Œä¸éœ€è¦æ”¹åŠ¨ä»»ä½•å·²æœ‰çš„ä»£ç ï¼Œæ·»åŠ  `TvReceiver`ã€`TvOnCommand`ã€`TvOffCommand` è¿™å‡ ä¸ªç±»å³å¯ã€‚

# æ¨¡å¼åˆ†æ

**ğŸ‰ ä¼˜ç‚¹ï¼š**

- é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦
- æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“çš„åŠ å…¥åˆ°ç³»ç»Ÿä¸­
- å®¹æ˜“è®¾è®¡ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—ã€‚åªè¦æŠŠå‘½ä»¤å¯¹è±¡æ”¾åˆ°é˜Ÿåˆ—ï¼Œå°±å¯ä»¥å¤šçº¿ç¨‹çš„æ‰§è¡Œå‘½ä»¤

**ğŸ’£ ç¼ºç‚¹ï¼š**

- å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºé’ˆå¯¹æ¯ä¸€ä¸ªå‘½ä»¤éƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œå› æ­¤æŸäº›ç³»ç»Ÿå¯èƒ½éœ€è¦å¤§é‡å…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å½±å“å‘½ä»¤æ¨¡å¼çš„ä½¿ç”¨ã€‚

**ğŸ³ é€‚ç”¨ç¯å¢ƒï¼š**

- ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚
- ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚
- ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œã€‚
- ç³»ç»Ÿéœ€è¦å°†ä¸€ç»„æ“ä½œç»„åˆåœ¨ä¸€èµ·ï¼Œå³æ”¯æŒå®å‘½ä»¤ã€‚

**ğŸ» å®é™…åº”ç”¨åœºæ™¯ï¼š**

- ç•Œé¢çš„ä¸€ä¸ªæŒ‰é’®éƒ½æ˜¯ä¸€ä¸ªå‘½ä»¤
- æ¨¡æ‹ŸCMDï¼ˆDOSå‘½ä»¤ï¼‰
- è®¢å•çš„æ’¤é”€ / æ¢å¤
- è§¦å‘ - åé¦ˆæœºåˆ¶

# åœ¨ JdbcTemplate ä¸­çš„åº”ç”¨

åœ¨ Spring çš„ JdbcTemplate è¿™ä¸ªç±»ä¸­æœ‰ query() æ–¹æ³•ï¼Œquery() æ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªå†…éƒ¨ç±» QueryStatementCallbackï¼ŒQueryStatementCallback åˆå®ç°äº† StatementCallback æ¥å£ï¼Œå¦å¤–è¿˜æœ‰å…¶å®ƒç±»å®ç°äº†è¯¥æ¥å£ï¼ŒStatementCallback æ¥å£ä¸­åˆæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³• doInStatement()ã€‚åœ¨ execute() ä¸­åˆè°ƒç”¨äº† query()ã€‚

å°†å…¶å…³ç³»ç¼•ä¸€ç¼•å°±æ˜¯ï¼š

![](https://gitee.com/songjilong/FigureBed/raw/master/img/20200426002752.png)