æ‰€æœ‰ä»£ç å’Œç¬”è®°å‡å¯åœ¨ [æˆ‘çš„GitHub](https://github.com/songjilong/Design-Pattern) ä¸­è·å–ï¼Œä¸å«Œéº»çƒ¦å¯ä»¥ç‚¹ä¸ª star æ”¯æŒä¸€ä¸‹ ğŸ™ˆ

----

# åŸºæœ¬ä»‹ç»

1ã€ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰åˆå«éƒ¨åˆ†æ•´ä½“æ¨¡å¼ï¼Œä»–åˆ›å»ºäº†**å¯¹è±¡ç»„çš„æ ‘å½¢ç»“æ„**ï¼Œå°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶ç»“æ„ä»¥è¡¨ç¤ºã€Œ**æ•´ä½“ - éƒ¨åˆ†**ã€çš„å±‚æ¬¡å…³ç³»ã€‚

2ã€ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„è®¿é—®å…·æœ‰ä¸€è‡´æ€§ï¼Œå³ï¼šç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠç»„åˆå¯¹è±¡

# æ¨¡å¼ç»“æ„

**Componentï¼ˆæŠ½è±¡æ„ä»¶ï¼‰**ï¼šå®šä¹‰å‚åŠ ç»„åˆå¯¹è±¡çš„å…¬æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œå¯ä»¥å®šä¹‰ä¸€äº›é»˜è®¤çš„è¡Œä¸ºå’Œå±æ€§ã€‚

**Compositeï¼ˆå®¹å™¨æ„ä»¶ï¼‰**ï¼šæ ‘æå¯¹è±¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯ç»„åˆæ ‘æç»“ç‚¹å’Œå¶å­ç»“ç‚¹å½¢æˆä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚

**Leafï¼ˆå¶å­æ„ä»¶ï¼‰**ï¼šå¶å­æ„ä»¶çš„ä¸‹é¢æ²¡æœ‰å…¶ä»–åˆ†æ”¯ï¼Œä¹Ÿå°±æ˜¯éå†çš„æœ€å°å•ä½ã€‚

----

ç»„åˆæ¨¡å¼æœ‰ä¸¤ç§å®ç°ï¼š**å®‰å…¨æ¨¡å¼å’Œé€æ˜æ¨¡å¼**ï¼Œå…¶ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤º

- å®‰å…¨ç»„åˆæ¨¡å¼ï¼šåœ¨æŠ½è±¡æ„ä»¶è§’è‰²ä¸­æ²¡æœ‰å£°æ˜ä»»ä½•ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œæ˜¯åœ¨å®¹å™¨æ„ä»¶ `Composite` ç±»ä¸­å£°æ˜å¹¶å®ç°è¿™äº›æ–¹æ³•ã€‚
- é€æ˜ç»„åˆæ¨¡å¼ï¼šæŠ½è±¡æ„å»ºè§’è‰²ä¸­å£°æ˜äº†æ‰€æœ‰ç”¨äºç®¡ç†æˆå‘˜å¯¹è±¡çš„æ–¹æ³•ï¼Œå¯¹å…¶å®ƒæ„ä»¶å…¬å¼€é€æ˜ã€‚

![](https://gitee.com/songjilong/FigureBed/raw/master/img/20200407115121.png)

# ç®€å•æ¡ˆä¾‹

> è¦æ±‚ï¼šåœ¨é¡µé¢å±•ç¤ºå‡ºå…¬å¸çš„éƒ¨é—¨ç»„æˆï¼ˆä¸€ä¸ªå…¬å¸æœ‰å¤šä¸ªéƒ¨é—¨ï¼Œæ¯ä¸ªéƒ¨é—¨æœ‰å¤šä¸ªå°ç»„ï¼‰ï¼›
>
> è¿™æ˜¯ä¸€ç§å¾ˆæ˜æ˜¾çš„æ ‘å½¢ç»“æ„ï¼Œå› æ­¤å¯ä»¥ç”¨ç»„åˆæ¨¡å¼è§£å†³

**ã€ŒæŠ½è±¡æ„ä»¶ã€ï¼š**OrganizationComponent

```java
public abstract class OrganizationComponent {
    private String name;

    public OrganizationComponent(String name) {
        this.name = name;
    }

    protected void add(OrganizationComponent component) {
        throw new UnsupportedOperationException("ä¸æ”¯æŒæ·»åŠ æ“ä½œ");
    }

    protected void remove(OrganizationComponent component) {
        throw new UnsupportedOperationException("ä¸æ”¯æŒåˆ é™¤æ“ä½œ");
    }

    protected abstract void print();


    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

**ã€Œå®¹å™¨æ„ä»¶ã€ï¼š**Companyã€Department

```java
public class Company extends OrganizationComponent {
    private List<OrganizationComponent> components = new ArrayList<>();

    public Company(String name) {
        super(name);
    }

    @Override
    protected void add(OrganizationComponent component) {
        components.add(component);
    }

    @Override
    protected void remove(OrganizationComponent component) {
        components.remove(component);
    }

    @Override
    protected void print() {
        System.out.println("======="+getName()+"=======");
        for (OrganizationComponent component : components) {
            component.print();
        }
    }

    @Override
    public String getName() {
        return super.getName();
    }
}
```

```java
public class Department extends OrganizationComponent {
    private List<OrganizationComponent> components = new ArrayList<>();

    public Department(String name) {
        super(name);
    }

    @Override
    protected void add(OrganizationComponent component) {
        components.add(component);
    }

    @Override
    protected void remove(OrganizationComponent component) {
        components.remove(component);
    }

    @Override
    protected void print() {
        System.out.println("======="+getName()+"=======");
        for (OrganizationComponent component : components) {
            component.print();
        }
    }

    @Override
    public String getName() {
        return super.getName();
    }
}
```

**ã€Œå¶å­æ„ä»¶ã€ï¼š**Groupï¼Œå¶å­æ„ä»¶ä¸æ²¡æœ‰å­èŠ‚ç‚¹äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ã€åˆ é™¤ä¹‹ç±»çš„æ–¹æ³•

```java
public class Group extends OrganizationComponent {
    public Group(String name) {
        super(name);
    }

    @Override
    protected void print() {
        System.out.println(getName());
    }

    @Override
    public String getName() {
        return super.getName();
    }
}
```

**ã€Œæµ‹è¯•ç±»ã€ï¼š**Client

```java
public class Client {
    @Test
    public void test01(){
        OrganizationComponent company = new Company("é˜¿é‡Œå·´å·´");

        OrganizationComponent department1 = new Department("å¸‚åœºéƒ¨");
        OrganizationComponent department2 = new Department("æŠ€æœ¯éƒ¨");

        OrganizationComponent group1 = new Group("å¸‚åœºä¸€ç»„");
        OrganizationComponent group2 = new Group("å¸‚åœºäºŒç»„");
        OrganizationComponent group3 = new Group("æŠ€æœ¯ä¸€ç»„");
        OrganizationComponent group4 = new Group("æŠ€æœ¯äºŒç»„");

        //æ·»åŠ éƒ¨é—¨
        company.add(department1);
        company.add(department2);
        //æ·»åŠ å°ç»„
        department1.add(group1);
        department1.add(group2);
        department2.add(group3);
        department2.add(group4);

        //æ‰“å°ç»“æœ
        company.print();
    }
}
```

**ã€Œè¿è¡Œç»“æœã€**

```
=======é˜¿é‡Œå·´å·´=======
=======å¸‚åœºéƒ¨=======
å¸‚åœºä¸€ç»„
å¸‚åœºäºŒç»„
=======æŠ€æœ¯éƒ¨=======
æŠ€æœ¯ä¸€ç»„
æŠ€æœ¯äºŒç»„
```

# åœ¨ HashMap ä¸­çš„åº”ç”¨

åœ¨ Javaï¼ˆjdk 1.8ä¸ºä¾‹ï¼‰ çš„é›†åˆç±» HashMap ä¸­ï¼ŒæŠ½è±¡æ„ä»¶æ˜¯ Mapï¼Œå®¹å™¨æ„ä»¶æ˜¯ HashMapï¼Œå¶å­æ„ä»¶æ˜¯ Node

è¿›å…¥æºç å¯ä»¥çœ‹è§ï¼Œåœ¨ Map ä¸­å®šä¹‰äº†è®¸å¤šå…¬å…±æ–¹æ³•

![](https://gitee.com/songjilong/FigureBed/raw/master/img/20200407132837.png)

HashMap å®ç°äº† Mapï¼Œå¹¶å¯¹ä¸€äº›æ–¹æ³•é‡å†™ï¼Œè€Œä¸” HashMap ä¸­æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±» Nodeï¼Œå®ƒå°±å……å½“äº†å¶å­æ„ä»¶çš„è§’è‰²ï¼ŒNode ä¸­å»é™¤äº† putã€putAll ç­‰æ–¹æ³•ï¼Œä¸‹é¢ä¹Ÿæ²¡æœ‰å­ç»“ç‚¹äº†

ä½¿ç”¨ï¼š

```java
@Test
public void test02(){
    Map<String, String> map = new HashMap<>();
    map.put("k1", "v1");
    map.put("k2", "v2");
    System.out.println(map);
}
```

å½“æˆ‘ä»¬ put ä¸€ä¸ªé”®å€¼å¯¹çš„æ—¶å€™ï¼Œåœ¨ HashMap å†…éƒ¨ä¼šè°ƒç”¨ putVal æ–¹æ³•ï¼Œå°†é”®å€¼å¯¹å°è£…ä¸º Nodeã€‚

# æ€»ç»“

1ã€ç®€åŒ–å®¢æˆ·ç«¯æ“ä½œã€‚å®¢æˆ·ç«¯åªéœ€è¦é¢å¯¹ä¸€è‡´çš„å¯¹è±¡è€Œä¸ç”¨è€ƒè™‘æ•´ä½“éƒ¨åˆ†æˆ–è€…èŠ‚ç‚¹å¶å­çš„é—®é¢˜ã€‚

2ã€å…·æœ‰è¾ƒå¼ºçš„æ‰©å±•æ€§ã€‚å½“æˆ‘ä»¬è¦æ›´æ”¹ç»„åˆå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒæ•´å†…éƒ¨çš„å±‚æ¬¡å…³ç³»ï¼Œå®¢æˆ·ç«¯ä¸ç”¨åšå‡ºä»»ä½•æ”¹åŠ¨ã€‚

3ã€æ–¹ä¾¿åˆ›å»ºå‡ºå¤æ‚çš„å±‚æ¬¡ç»“æ„ã€‚å®¢æˆ·ç«¯ä¸ç”¨ç†ä¼šç»„åˆé‡Œé¢çš„ç»„æˆç»†èŠ‚ï¼Œå®¹æ˜“æ·»åŠ èŠ‚ç‚¹æˆ–è€…å¶å­ä»è€Œåˆ›å»ºå‡ºå¤æ‚çš„æ ‘å½¢ç»“æ„ã€‚

4ã€éœ€è¦éå†ç»„ç»‡æœºæ„ï¼Œæˆ–è€…å¤„ç†çš„å¯¹è±¡å…·æœ‰æ ‘å½¢ç»“æ„æ—¶ï¼Œéå¸¸é€‚åˆä½¿ç”¨ç»„åˆæ¨¡å¼ã€‚

5ã€è¦æ±‚è¾ƒé«˜çš„æŠ½è±¡æ€§ã€‚å¦‚æœèŠ‚ç‚¹å’Œå¶å­æœ‰å¾ˆå¤šå·®å¼‚æ€§çš„è¯ï¼Œæ¯”å¦‚å¾ˆå¤šæ–¹æ³•å’Œå±æ€§éƒ½ä¸ä¸€æ ·ï¼Œä¸é€‚åˆä½¿ç”¨ç»„åˆæ¨¡å¼ã€‚